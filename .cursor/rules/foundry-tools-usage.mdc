---
description:
globs:
alwaysApply: true
---
# Foundry Tools Usage Guide

## Using Cast - Command-Line Blockchain Interaction

Cast is Foundry's Swiss Army knife for interacting with Ethereum from the command line. **Use Cast for blockchain utilities and quick operations** rather than writing custom scripts for common tasks.

## Common Cast Utilities

### Cryptographic Operations
```bash
# Compute keccak256 hash
cast keccak "transfer(address,uint256)"

# Generate function selector (4-byte signature)
cast sig "transfer(address,uint256)"

# Encode calldata
cast calldata "transfer(address,uint256)" 0x... 1000

# Decode calldata
cast calldata-decode "transfer(address,uint256)" 0xa9059cbb...
```

### Reading from Blockchain
```bash
# Read contract state (call)
cast call CONTRACT_ADDRESS "balanceOf(address)" USER_ADDRESS --rpc-url $RPC_URL

# Get storage at specific slot
cast storage CONTRACT_ADDRESS 0 --rpc-url $RPC_URL

# Get full storage layout (requires verified contract)
cast storage CONTRACT_ADDRESS --rpc-url $RPC_URL

# Get transaction receipt
cast receipt TX_HASH --rpc-url $RPC_URL

# Get current gas price
cast gas-price --rpc-url $RPC_URL

# Get account nonce
cast nonce ADDRESS --rpc-url $RPC_URL

# Get block number
cast block-number --rpc-url $RPC_URL

# Get contract bytecode
cast code CONTRACT_ADDRESS --rpc-url $RPC_URL
```

### Writing to Blockchain
```bash
# Send transaction (write operation)
cast send CONTRACT_ADDRESS "setNumber(uint256)" 42 --rpc-url $RPC_URL --private-key $PRIVATE_KEY

# Estimate gas for transaction
cast estimate CONTRACT_ADDRESS "transfer(address,uint256)" RECIPIENT 1000 --rpc-url $RPC_URL
```

### Data Conversion Utilities
```bash
# Convert between units
cast to-wei 1 ether        # Convert to wei
cast from-wei 1000000000000000000  # Convert from wei

# Hex conversions
cast to-hex 255            # Decimal to hex
cast to-dec 0xff           # Hex to decimal
cast to-uint256 100        # Convert to uint256 format

# Address utilities
cast to-checksum-address 0x...  # EIP-55 checksum
cast compute-address DEPLOYER NONCE  # Compute deployment address
```

### ENS Operations
```bash
# Resolve ENS name to address
cast resolve-name "vitalik.eth" --rpc-url $RPC_URL

# Reverse ENS lookup
cast lookup-address 0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045 --rpc-url $RPC_URL

# Compute ENS namehash
cast namehash "vitalik.eth"
```

### Advanced Features
```bash
# Run transaction locally and get trace
cast run TX_HASH --rpc-url $RPC_URL

# Extract selectors from bytecode
cast selectors BYTECODE

# 4byte directory lookup
cast 4byte 0xa9059cbb  # Returns: transfer(address,uint256)
```

## When to Use Cast vs Custom Code

### Use Cast for:
- Quick keccak256 hashing of function signatures or data
- Reading contract state, storage slots, balances
- Sending simple transactions
- Converting between data formats (hex, decimal, wei, ether)
- ENS lookups and resolution
- Getting blockchain data (gas price, nonce, block info)
- Debugging transactions with traces
- Computing contract addresses before deployment

### Write custom code when:
- Building complex multi-step interactions
- Implementing business logic
- Creating reusable libraries or contracts
- Needing programmatic control flow
- Building user interfaces or applications

## Integration with Tests and Scripts

In Forge tests and scripts, you can leverage Cast-like functionality through the `vm` cheatcodes:

```solidity
// In tests - equivalent to cast keccak
bytes32 hash = keccak256("transfer(address,uint256)");

// Reading storage - equivalent to cast storage
bytes32 value = vm.load(address(contract), bytes32(uint256(0)));

// Labels for cast call-like clarity in traces
vm.label(address(token), "WETH");
```

## Best Practices

1. **Use Cast for prototyping**: Before writing a complex script, test your calls with Cast
2. **Verify with Cast**: After deployments, use Cast to verify contract state
3. **Debug with Cast**: Use `cast run` to debug failed transactions
4. **Prefer Cast for one-offs**: Don't write scripts for operations Cast can handle
5. **Chain Cast commands**: Combine Cast commands with shell scripting for powerful workflows

```bash
# Example: Get function selector and use it
SELECTOR=$(cast sig "transfer(address,uint256)")
cast call $CONTRACT $SELECTOR $RECIPIENT $AMOUNT --rpc-url $RPC_URL
```

## Essential Forge Commands

```bash
# Building and testing
forge build                    # Compile contracts
forge test                     # Run all tests
forge test --match-test NAME   # Run specific test
forge test --match-contract NAME # Run tests in specific contract
forge coverage                 # Generate coverage report
forge fmt                      # Format Solidity code

# Gas analysis
forge snapshot                 # Create gas snapshot
forge test --gas-report        # Show gas usage

# Debugging and analysis
forge inspect CONTRACT bytecode # Get contract bytecode
forge inspect CONTRACT storage-layout # Get storage layout
forge inspect CONTRACT abi     # Get contract ABI
forge doc                      # Generate documentation
```

## Configuration Reference

Check [foundry.toml](mdc:foundry.toml) for project-specific Foundry configuration including:
- Compiler settings
- Test configurations
- Gas reporting settings
- RPC endpoints

Remember: Cast is your go-to tool for command-line blockchain interaction. It's faster and more reliable than writing custom utilities for common operations.
